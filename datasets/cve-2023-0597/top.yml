rule:
  meta:
    name: CVE-2023-0597 cpu_entry_area write gadget exploit (composite)
    namespace: cve/linux/cpu_entry_area
    authors:
      - yeajongcheol
    references:
      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-0597
    scopes:
      static: file
      dynamic: unsupported
  features:
    - and:
      # 필수 1: fs:0x28 카나리 접근(여러 함수에서 관찰됨)
      - match: fs canary access (0597 anchor)

      # 필수 2: PoC 스캐폴딩 중 최소 1개
      - or:
        - match: daemonize helper (signal/setsid)
        - match: memfd payload helper (PoC scaffold)
        - match: userns setup helper (PoC scaffold)

      # 필수 3: call 인자 준비/심볼/상수 중 최소 1개
      - or:
        - match: argprep rbp-0xa0 before write (0597)
        - match: presence of write_to_cpu_entry_area symbol (0597)
        - match: kernel addr constant cbfff800 (0597)
