rule:
  meta:
    name: CVE-2023-0597 cpu_entry_area write (api-based)
    namespace: cve/linux/bpf
    authors:
      - yeajongcheol
    scopes:
      static: file
      dynamic: unsupported
    tags:
      - cve-2023-0597
      - cpu_entry_area
    references:
      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-0597
    description: >
      CVE-2023-0597: cpu_entry_area write gadget.

      **API-BASED** Pattern:
      - UNIQUE: unshare() + prctl() combination
      - Uses BPF syscall
      - May use seccomp for filtering

      Key identifier: unshare (NO other BPF CVE uses this!)
  features:
    - and:
      # REQUIRED: unshare (UNIQUE!)
      - match: unshare syscall (api-based)

      # REQUIRED: prctl
      - match: prctl syscall (api-based)

      # REQUIRED: BPF
      - match: bpf syscall (api-based)

      # EXCLUSION
      - not:
        - or:
          - match: setsockopt syscall (api-based)
          - match: writev syscall (api-based)
