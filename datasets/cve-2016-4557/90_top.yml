rule:
  meta:
    name: CVE-2016-4557 BPF map-fd double-put
    namespace: cve/linux/bpf
    authors:
      - yeajongcheol
    scopes:
      static: file
      dynamic: unsupported
    tags:
      - cve-2016-4557
    references:
      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-4557
    description: >
      CVE-2016-4557 BPF map-fd double-put exploit.
      Detects multiple variants using different patterns.
  features:
    - and:
      - match: BPF syscall with PROG_LOAD (CVE-2016-4557 core)
      - or:
        - match: BPF with writev syscall (CVE-2016-4557 variant 1)
        - match: has writev indicator (CVE-2016-4557 indicator)
        - match: BPF with PROG_LOAD string (CVE-2016-4557 variant 2)
        - match: BPF with /proc/self/maps (CVE-2016-4557 variant 3)
